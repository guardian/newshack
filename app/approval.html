<section class="module-approval">
	<div id='approval-chart'>
		<div id='approval-canvas'></div>
		<div id='source'>Washington Post/ABC News poll<br>margin of error: &plusmn;3.5 percentage points</div>
	</div>
		
	<style>
		#approval-canvas {
			font-family: Arial;
			font-size: 11px;
			overflow: hidden;
			width: 100%;
		}
		#approval-canvas .tick text {
			fill: #999;
		}
		#approval-canvas #yaxis .y-tick {
			stroke: #eee;
		}
		#approval-canvas #xaxis text {
			font-size: 14px;
		}
		#line-r {
			fill: none;
			stroke: #d61d00;
			stroke-width: 4px;
		}
		
		#line-d {
			fill: none;
			stroke: #066ec9;
			stroke-width: 4px;
		}
		
		#line-o {
			fill: none;
			stroke: #fede01;
			stroke-width: 4px;
		}
		
		.dot-o {
			fill: #fede01;;
		}
		
		.dot-d {
			fill: #066ec9;;
		}
		
		.dot-r {
			fill: #d61d00;;
		}
		
		#approval-canvas #yaxis .domain {
			fill: none;
			stroke-width: 1px;
		}
		#approval-canvas #xaxis .domain {
			fill: none;
			stroke: black;
			//stroke-width: 2px;
		}
		#approval-canvas .x-tick {
			stroke: black;
		}
		
		
		#approval-chart .approval-lbl {
			font-weight: bold;
			font-size: 14px;
		}
		#approval-chart #source {
			text-align:right;
			color: #666;
			font-size: 11px;
			font-family: Arial;
			margin-right: 10px;
		}
	</style>
	<script src = 'scripts/d3.v3.min.js'></script>
	<script>
	var approvalChart = function(mod, $){
		var svg,
			width,
			height,
			max,
			xAxis,
			yAxis,
			line,
			margin = {top: 20, right: 20, bottom: 10, left: 50},
			padding = 25,
			approval = {
				'r': [63,70,74],
				'd': [56,61,61],
				'o': [50,51,53]
			}
			 
		mod.init = function(){
			
			getSizes()
			
			svg = d3.select("#approval-canvas").append("svg:svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
			    .append("g")
						
			svg.append("g")
			      .attr("class", "x axis")
				  .attr("id", 'xaxis')
				
			svg.append("g")
			      .attr("class", "y axis")
				  .attr("id", 'yaxis')
			      
			svg.append("path")
			      .datum(approval.r)
				  .attr('id', 'line-r')

			svg.append("path")
			      .datum(approval.d)
				  .attr('id', 'line-d')
					
			svg.append("path")
			      .datum(approval.o)
				  .attr('id', 'line-o')

			svg.selectAll('.dot-r')
				.data(approval.r)
				.enter()
					.append('circle')
					.attr('class','dot-r')
					.attr('r', 5)
					
					
			svg.selectAll('.dot-d')
				.data(approval.d)
				.enter()
					.append('circle')
					.attr('class','dot-d')
					.attr('r', 5)
				
		
			svg.selectAll('.dot-o')
				.data(approval.o)
				.enter()
					.append('circle')
					.attr('class','dot-o')
					.attr('r', 5)

			svg.append("text")
				.text('Republicans in Congress')
				.style('text-anchor', 'end')
				.attr('id', 'lbl-r')
				.attr('class', 'approval-lbl')
				.attr('x', width)

			svg.append("text")
				.text('Democrats in Congress')
				.style('text-anchor', 'end')
				.attr('id', 'lbl-d')
				.attr('class', 'approval-lbl')
				.attr('x', width)

			svg.append("text")
				.text('Barack Obama')
				.style('text-anchor', 'end')
				.attr('id', 'lbl-o')
				.attr('class', 'approval-lbl')
				.attr('x', width)			

			
			resize();
			$(window).resize(function(){
				getSizes();
				resize();
			})
		}
		
		var resize = function(){
			
			d3.select("#approval-canvas svg")
				.attr('width', width)
				.attr('height', height)
			
			var x = d3.scale.linear()
			    .range([margin.left, width - margin.right ])
				.domain([0, 2]);
		
	
			var y = d3.scale.linear()
			    .range([height - margin.top - margin.bottom, margin.bottom])
				.domain([0, 100]);
			
		
			xAxis = d3.svg.axis()
			    .scale(x)
				.ticks(2)
				.tickFormat(function(d,i){
					if(i == 0){
						return 'Sep 25-29';
					} else if(i == 1){
						return 'Oct 2-6';
					} else if( i == 2) {
						return 'Oct 9-13';
					}
				})
			    .orient("bottom")
			
				
			yAxis = d3.svg.axis()
			    .scale(y)
				.tickFormat(function(d,i){
					if (i == 0){
						return '0 %'
					} else {
						return d
					}
				})
			    .orient("left");
			
			line = d3.svg.line()
			    .x(function(d,i) { return x(i); })
			    .y(function(d) { return y(d); });
			
	
			
			svg.select('#xaxis')
					.attr("transform", "translate(0," + (height - margin.top - margin.bottom) + ")")
					.call(xAxis);
					
			svg.select('#yaxis')
					.attr("transform", "translate(" + margin.left +",0)")
					.call(yAxis);
				
		
			svg.select('#line-r')
					 .attr("d", line);
					
			svg.select('#line-d')
					 .attr("d", line);
					
			svg.select('#line-o')
					 .attr("d", line);
					
			svg.selectAll('.dot-o')
				.attr('cx', function(d,i){
					return x(i)
				})
				.attr('cy', y)
				
			svg.selectAll('.dot-r')
				.attr('cx', function(d,i){
					return x(i)
				})
				.attr('cy', y)
				
			svg.selectAll('.dot-d')
				.attr('cx', function(d,i){
					return x(i)
				})
				.attr('cy', y)
			
			svg.selectAll('#xaxis text')
				.style('text-anchor', function(i){
					if(i == 0){
						return 'start'
					} else if( i == 1){
						return 'middle'
					} else if( i == 2){
						return 'end'
					}
				})
	
			svg.select('#lbl-r')
				.attr('y', y(approval.r[2]) - 5)
				.attr('x', width - margin.right)
			
			svg.select('#lbl-d')
				.attr('y', y(approval.d[2]) - 5)
				.attr('x', width - margin.right)
				
			svg.select('#lbl-o')
				.attr('y', y(approval.o[2]) + 15)
				.attr('x', width - margin.right)
	
	
		svg.selectAll('#xaxis .tick line')
			.attr('class', 'x-tick')
			.attr('y1', -10 )	
			.attr('y2', 0)
			.attr('x1', 0)
			.attr('x2', 0)
			.style('stroke-width', 2)
			
		svg.selectAll('#yaxis line')
			.attr('class', 'y-tick')
			.attr('y1', 0 )	
			.attr('y2', 0)
			.attr('x1', 0)
			.attr('x2', width - margin.right - margin.left)		
		}
		
		var getSizes = function(){
			width = $('#approval-canvas').width()
			height = width * 9 / 16;
			
		}
	
	
		return mod;
	}({}, jQuery)
	
	approvalChart.init()
	</script>

	
</section>